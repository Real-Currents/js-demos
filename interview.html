<!doctype html>
<html>
    <head>
        <style>
            tr {
                min-width: 50px;
                min-height: 50px;
                height: 50px;
            }
            td {
                border: 2px solid black;
                min-width: 50px;
                min-height: 50px;
                height: 50px;
                text-align: center;
            }
        </style>
    </head>
    <body>
    <table id='tic-tac'>
        <tbody>
        <tr>
            <td id='00'></td>
            <td id='01'></td>
            <td id='02'></td>
        </tr>
        <tr>
            <td id='10'></td>
            <td id='11'></td>
            <td id='12'></td>
        </tr>
        <tr>
            <td id='20'></td>
            <td id='21'></td>
            <td id='22'></td>
        </tr>
        </tbody>
    </table>

    <script type="text/javascript">(function () {
        var turn = 0;
        var tics = [];
        var game = document.getElementById('tic-tac');

        for (var i = 0; i < 3; i++) {
            for (var j = 0; j < 3; j++) {
                tics.push(document.getElementById(("" + i) + ("" + j)));
            }
        }

        var evalGame = function(t) {
            var ticValues = {};
            var diagonal1 = {};
            var diagonal2 = {};
            var horizontal1 = {};
            var horizontal2 = {};
            var horizontal3 = {};
            var vertical1 = {};
            var vertical2 = {};
            var vertical3 = {};
            var diagTics1 = [];
            var diagTics2 = [];
            var horzTics = [];
            var vertTics = [];
            vertTics[0] = [];
            vertTics[1] = [];
            vertTics[2] = [];

            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    ticValues[("" + i) + ("" + j)] = t[i*3 + j];
                }
            }

            for (let ii = 0; ii < 3; ii++) {
                horzTics = [];

                for (let jj = 0; jj < 3; jj++) {
                    if (ticValues[("" + ii) + ("" + jj)] != "") {

                        horzTics.push(ticValues[("" + ii) + ("" + jj)]);

                        vertTics[jj].push(ticValues[("" + ii) + ("" + jj)]);

                        if (
                            ("" + ii) + ("" + jj) == '00' ||
                            ("" + ii) + ("" + jj) == '11' ||
                            ("" + ii) + ("" + jj) == '22'
                        ) {
                            diagTics1.push(ticValues[("" + ii) + ("" + jj)]);
                        }

                        if (
                            ("" + ii) + ("" + jj) == '02' ||
                            ("" + ii) + ("" + jj) == '11' ||
                            ("" + ii) + ("" + jj) == '20'
                        ) {
                            diagTics2.push(ticValues[("" + ii) + ("" + jj)]);
                        }

                        if (horzTics.length > 2) {
                            var horizontal = (ii == 0) ?
                                horizontal1 : (ii == 1) ?
                                    horizontal2 :
                                        horizontal3;

                            var hasX = false;
                            var hasO = false;
                            horzTics.forEach(function(v2, i2, a2) {
                                if (v2 == "X") hasX = true;
                                else if (v2 == "O") hasO = true;
                            });
                            if (hasX && !hasO) horizontal["X"] = true;
                            if (!hasX && hasO) horizontal["O"] = true;
                            if (hasX && hasO) horizontal["mixed"] = true;
                        }
                        if (vertTics[jj].length > 2) {
                            var vertical = (jj == 0) ?
                                vertical1 : (jj == 1) ?
                                    vertical2 :
                                        vertical3;

                            var hasX = false;
                            var hasO = false;
                            vertTics[jj].forEach(function(v2, i2, a2) {
                                if (v2 == "X") hasX = true;
                                else if (v2 == "O") hasO = true;
                            });
                            if (hasX && !hasO) vertical["X"] = true;
                            if (!hasX && hasO) vertical["O"] = true;
                            if (hasX && hasO) vertical["mixed"] = true;
                        }
                        if (diagTics1.length > 2) {
                            var hasX = false;
                            var hasO = false;
                            diagTics1.forEach(function(v2, i2, a2) {
                                if (v2 == "X") hasX = true;
                                else if (v2 == "O") hasO = true;
                            });
                            if (hasX && !hasO) diagonal1["X"] = true;
                            if (!hasX && hasO) diagonal1["O"] = true;
                            if (hasX && hasO) diagonal1["mixed"] = true;
                        }
                        if (diagTics2.length > 2) {
                            var hasX = false;
                            var hasO = false;
                            diagTics2.forEach(function(v2, i2, a2) {
                                if (v2 == "X") hasX = true;
                                else if (v2 == "O") hasO = true;
                            });
                            if (hasX && !hasO) diagonal2["X"] = true;
                            if (!hasX && hasO) diagonal2["O"] = true;
                            if (hasX && hasO) diagonal2["mixed"] = true;
                        }
                    }
                }
            }

            var result = {};
            var kind;

            for (kind in horizontal1) {
                if (horizontal1[kind]) result["horizontal1"] = horizontal1;
            }
            for (kind in horizontal2) {
                if (horizontal2[kind]) result["horizontal2"] = horizontal2;
            }
            for (kind in horizontal3) {
                if (horizontal3[kind]) result["horizontal3"] = horizontal3;
            }
            for (kind in vertical1) {
                if (vertical1[kind])  result["vertical1"] = vertical1;
            }
            for (kind in vertical2) {
                if (vertical2[kind])  result["vertical2"] = vertical2;
            }
            for (kind in vertical3) {
                if (vertical3[kind])  result["vertical3"] = vertical3;
            }
            for (kind in diagonal1) {
                if (diagonal1[kind])  result["diagonal1"] = diagonal1;
            }
            for (kind in diagonal2) {
                if (diagonal2[kind])  result["diagonal2"] = diagonal2;
            }
            return result;
        };

        for (var tic of tics) {

            tic.onclick = function(evt) {
                if (evt.target.innerHTML != "") return;

                if (turn == 0) {
                    evt.target.innerHTML = "X";
                    turn = 1;
                } else {
                    evt.target.innerHTML = "O";
                    turn = 0;
                }

                var gameState = evalGame(tics.map(d => d.innerHTML));
                console.log(gameState);

                var stalemate = {};

                for (var kind in gameState) {
                    var endMsg = document.createElement('h1');

                    if ('X' in gameState[kind]) {
                        endMsg.innerHTML =  "X WINS";
                        game.parentNode.append(endMsg);
                        break;

                    } else if ('O' in gameState[kind] ) {
                        endMsg.innerHTML = "O WINS";
                        game.parentNode.append(endMsg);
                        break;

                    } else {
                        stalemate[kind] = gameState[kind];
                        if (
                            (
                                ( // Are 1 row and 2 columns filled with mixed markers?
                                    (
                                        ('horizontal1' in stalemate && 'horizontal2' in stalemate) &&
                                        'vertical1' in stalemate
                                    ) ||
                                    (
                                        ('horizontal2' in stalemate && 'horizontal3' in stalemate) &&
                                        'vertical2' in stalemate
                                    ) ||
                                    (
                                        ('horizontal1' in stalemate && 'horizontal3' in stalemate) &&
                                        'vertical3' in stalemate
                                    ) ||
                                    (
                                        ('horizontal1' in stalemate && 'horizontal2' in stalemate) &&
                                        'vertical2' in stalemate
                                    ) ||
                                    (
                                        ('horizontal2' in stalemate && 'horizontal3' in stalemate) &&
                                        'vertical3' in stalemate
                                    ) ||
                                    (
                                        ('horizontal1' in stalemate &&  'horizontal3' in stalemate) &&
                                        'vertical1' in stalemate
                                    ) ||
                                    (
                                        ('horizontal1' in stalemate && 'horizontal2' in stalemate) &&
                                        'vertical3' in stalemate
                                    ) ||
                                    (
                                        ('horizontal2' in stalemate && 'horizontal3' in stalemate) &&
                                        'vertical1' in stalemate
                                    ) ||
                                    (
                                        ('horizontal1' in stalemate &&  'horizontal3' in stalemate) &&
                                        'vertical2' in stalemate
                                    )
                                ) ||
                                ( // Are 2 rows and 1 columns filled with mixed markers?
                                    (
                                        'horizontal1' in stalemate &&
                                        ('vertical2' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal2' in stalemate &&
                                        ('vertical1' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal3' in stalemate  &&
                                        ('vertical1' in stalemate && 'vertical2' in stalemate)
                                    ) ||
                                    (
                                        'horizontal2' in stalemate &&
                                        ('vertical2' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal3' in stalemate &&
                                        ('vertical1' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal1' in stalemate  &&
                                        ('vertical1' in stalemate && 'vertical2' in stalemate)
                                    ) ||
                                    (
                                        'horizontal3' in stalemate &&
                                        ('vertical2' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal1' in stalemate &&
                                        ('vertical1' in stalemate && 'vertical3' in stalemate)
                                    ) ||
                                    (
                                        'horizontal2' in stalemate  &&
                                        ('vertical1' in stalemate && 'vertical2' in stalemate)
                                    )
                                )
                            ) && (
                                // Are both diagonals filled with mixed markers?
                                'diagonal1' in stalemate && 'diagonal2' in stalemate
                            )
                        ) {
                            endMsg.innerHTML = "STALE MATE";
                            game.parentNode.append(endMsg);
                        }
                    }
                }
            };
        }
    } ());
    </script>
    </body>
</html>
